# «Спогадайчик»
## **Мета проекту:** 
розробити бот-додаток для сповіщень на основі бібліотеки React.js. 
## **Проблематика проекту:**
  Для життя у сучасному суспільстві треба завжди підкорятися його ритму. Треба вміти планувати свій час, тримати у голові велику кількість задач та цілей на день, на тиждень, на рік тощо. Тому не дивно, що кожен з нас все частіше забуває про маленькі, але такі важливі дрібниці, без яких можна втратити багато важливих контактів, або які потім  можуть призвести до великих проблем.
  
  Основна проблема сучасної людини – ми забуваємо привітати наших друзів та колег з їх персональним святом – Днем народження. Але ж це так важливо, відчувати, що про тебе пам’ятають і хочуть розділити твою радість, нагадати, що ще один рік пройшов не даремно і приніс багато щастя.
  
  Саме це і є першою та основною задачею цього Боту. Бот буде додаватися до корпоративного чату (якщо такий є) або до персональних повідомлень, та завдяки інтеграції з календарем та зручному інтерфейсу, буде швидко налаштовуватися, щоб потім нагадувати вам про радісні події у вашому житті та житті ваших друзів, а також першим їх вітати.
  
  Також в боті можна буде налаштувати сповіщення про поточні задачі, розклад тощо. Це зробить його ще зручнішим для корпоративних чатів. А функція «замітки», які будуть створюватися та викликатися коротким реченням-заголовком зробить цього Бота дуже зручним та просто чарівним.
  
Отже, підіб'ємо список **початкових завдань** для створення Боту:
1.	Прописати початковий функціонал боту(може змінитися в процесі розробки)
2.	Продумати та розобити зручний інтерфейс для користувача
3.	Провести інтеграцію з календарем (реалізація на етапі обмірковування) 
4.	Розробити можливість додавання боту до корпоративих чатів з великою кількістю людей
5.	Перевірити Бот на наявнісь багів

![Lets go](https://media4.giphy.com/media/l0HlxJMw7rkPTN8sg/giphy.gif)
------------------------------------------------------------------------------------
## **Аналіз предметної області:**
  Зараз існують декілька видів програмного забезпечення, які допомагають уникнути вищеназваних проблем. В більшості це календарі з нагадуваннями, нотатки та інше. В своїй більшості ці програмні забезпечення існують у вигляді додатків на платформах Android та IOS. 
  
|Вимоги|Критерії                     |Birthdays|hip                                          |Напоминалка|
|------|-----------------------------|---------|---------------------------------------------|-----------|
|Functionality (функциональність)|Кількість можливих подій     |необмежено|необмежено                                   |необмежено |
|      |Нагадування (алерти) про сьогоднішні події|✓        |✓                                            |✓          |
|      |Можливість прив’язки подій до контактів|✓        |✓                                            |✕          |
|      |Повідомлення про події за розкладом|✓        |✓                                            |✓          |
|      |Наявність додаткової інформації про події|✓        |✓                                            |✕          |
|      |Додавання нових користувачів |✕        |✕                                            |✕          |
|Usability (зручність роботи)|Доступ до функціоналу без утиліт|✕        |✕                                            |✕          |
|      |Підтримка Android            |✓        |✕                                            |✕          |
|      |Підтримка IOS                |✕        |✓                                            |✕          |
|      |Підтримка комп’ютерного ПО   |✕        |✕                                            |✓          |
|      |Зручний інтерфейс            |✓        |✓                                            |✓          |
|      |Наявність реклами            |✓        |✓                                            |✕          |
|      |Наявність платного контенту  |✕        |✓                                            |✕          |
|      |Багатомовність               |✓        |✓                                            |✓          |
|Reliability (надійність)|Захист персональних даних    |✓        |✓                                            |✓          |
|      |Резервне копіювання          |✓        |✓                                            |✕          |
|Performance (продуктивність)|Регулярне оновлення додатку  |✕        |✓                                            |✕          |
|      |Підтримка нових версій ПО    |✕        |✓                                            |✓          |
|Supportability        (підтримка)|Можливість зв’язку у соцмережах|✕        |✓                                            |✕          |
|      |Зворотній зв’язок            |✕        |✓                                            |✓          |

У висновку можна сказати, що кожен з додатків має свої суттєві недоліки, основні з яких: застаріла версії ПО, наявність платного контенту, необхідність в завантаженні додаткових утиліт, обмеженість однією операційною системою та використання ресурсів пам'яті пристрою.

# Обґрунтування вибору програмного забезпечення

Насамперед потрібно зазначити, що нещодавно з'явилася нова бібліотека Urban Bot. Вона адаптує React для написання чат-ботів різної складності, тож і наш проект ми будемо розробляти за допомогою її функціоналу.

> Чат-бот - це частіше за все окремий чат у месенджері, в якому ви спілкуєтеся з програмою. Він може надсилати повідомлення у вигляді тексту, зображень, кнопок й багатьох інших UI елементів і реагувати на повідомлення користувача. Сучасні чат-боти - це повноцінні UI додатки у месенджерах.

Urban Bot пропонує зовсім інший підхід до розробки чат-ботів - через декларативне програмування та компонентний підхід. Живий приклад, написаний на Urban Bot, можна спробувати у Telegram, [посилання](https://t.me/BaseExampleUrbanBot), і переглянути код на [GitHub](https://github.com/urban-bot/base-example).

Далі розглянемо декілька простих прикладів, які допоможуть познайомитися з основним функціоналом бібліотеки.

## Відправка повідомлень 
Цей код відправляє стандартне повідомлення користувачу з текстом `'Hello, world!'`
```js
import React from 'react';
import { Text } from '@urban-bot/core';

function App() {
    return (
        <Text>
           Hello, world!
        </Text>
    );
}
```

Зображення можна відправити так:

```js
import React from 'react';
import { Image } from '@urban-bot/core';

function App() {
    const imageByURL =  'https://some-link.com/image.jpg';

    return <Image file={imageByURL} />;
}
```
Urban Bot має готовий набір компонентів для кожного виду повідомлень: для файлів File, для кнопок ButtonGroup і багато інших. До кожного з них можна передати певний набір пропсів(об'єктів), наприклад, імітувати, що бот набирає повідомлення 1 секунду `<Text simulateTyping={1000}>`.

# Етапи розробки бота
## 0. Встановелння бібліотеки Urban Bot

Для початку розробки бота треба  встановити Urban Bot стартер-проект. В ньому знаходяться всі потрібні файли документації та бот з двома найпростішими функціями `/echo` та `/logo`. Існують **TypeScript** і **JavaScript** версії. 

Щоб встановити достатньо ввести в терміналі:

**TypeScript**
```npx create-urban-bot my-app```

**JavaScript**
```npx create-urban-bot my-app --template js```

Після встановлення готовий шаблон буде в директорії **my-app**, там де ви запускали `create-urban-bot`.

## 1. Етап налаштування та запуску
Відкрийте `my-app` в редакторі, в якому будете розробляти бота, знайдіть та відкрийте файл .env та введіть Telegram токен.
![image](https://user-images.githubusercontent.com/62243357/113441901-b8b4e480-93f7-11eb-9e6b-cc37a008cfb8.png)

Також треба активувати Telegram render. Для цього розкоментуйте // import ‘./render/telegram’; всередині src/index.ts чи src/index.js.
![image](https://user-images.githubusercontent.com/62243357/113442093-10535000-93f8-11eb-8127-ba0432361146.png)

Все готово для першого запуску бота. Напишіть команду `npm run dev` в терміналі та запустіть.
![image](https://user-images.githubusercontent.com/62243357/113442274-6aecac00-93f8-11eb-99a8-2512bcf91edb.png)

Перейдіть до вашого бота в Телеграмі. Так буде виглядати ваше діалогове вікно з ботом:
![image](https://user-images.githubusercontent.com/62243357/113442350-8e175b80-93f8-11eb-912e-4bbe981eb6d7.png)

Далі запустіть бота кнопкою внизу вікна. На те, щоб бот остаточно завершив запуск та виконав привітальний скрипт вперше знадобиться трохи часу, надалі такої затримки не буде. 
Далі бот має відповідати на дві команди  `/echo` та `/logo`.

## 2. Етап розробки
### 2.1 Серверна частина. Робота з базою даних
В першу чергу треба вирішити, яку з баз даних обрати для обробки вхідних запитів. Найчастіше для проектів на Java Script використовують базу даних MongoDB.
```MongoDB — документо-орієнтована система керування базами даних (СКБД) з відкритим вихідним кодом, яка не потребує опису схеми таблиць. 
MongoDB займає нішу між швидкими і масштабованими системами, що оперують даними у форматі ключ/значення, 
і реляційними СКБД, функціональними і зручними у формуванні запитів
```
MongoDB підтримує зберігання документів в JSON-подібному форматі, має досить гнучку мову для формування запитів, може створювати індекси для різних збережених атрибутів, ефективно забезпечує зберігання великих бінарних об'єктів, підтримує журналювання операцій зі зміни і додавання даних в БД, може працювати відповідно до парадигми Map/Reduce, підтримує реплікацію і побудову відмовостійких конфігурацій.

Наступним кроком, буде продумати кількість виконуваних ботом команд. В нашому випадку бот буде мати дві команди для виклику та виконання: `/create_birthday` та `/delete_birthday` для додавання та видалення інформації про день народження відповідно. Для того, щоб змінити інформацію про себе, потрібно буде видалити вже створену інформацію та створити нову. Потрібно також передбачити можливі помилки, та попередити їх на етапі розробки. Основна помилка може бути в тому, що створюються два і більше однакових користувачів в базі даних. Для того, щоб попередити цю помилку потрібно відслідковувати всі наміри додати нового користувача до бази даних. Якщо користувач вже існує - то запит повинен відхилитися. 

Коли всі аналітичні кроки завершилися можна переходити до програмування.

В першу чергу створюємо дві моделі (класи) для нашої бази даних `Chat` та `User`. Кожен новий користувач та чат буде новим об'єктом цих класів. При чому, якщо це персональний чат з ботом, то ID чату співпдає з ID користувача.

![image](https://user-images.githubusercontent.com/62243357/117720882-e3a90a00-b1e7-11eb-9d0e-f3f950d5f917.png)

Перший рядок - імпортуємо всі потрібні об'єкти бібліотеки mongoose. Ця бібліотека використовується для створення об'єктів бази даних mongoDB. 
Третій рядок змінна Chat типу `const` - створення єкземпляру класу Schema, що є новим класом з властивостями `chatId` типу `String` та `users`, яка є масивом елементів `type: ObjectId, ref: 'user'` остання властивість встановлює залежності між об'єктами класу User та Chat.

Останній рядок коду - експортуємо модель Chat, щоб імпортувати її у подальший наш код.

Аналогічно створюється модель User. В ній доадється декілька властивостей класу User в тому числі й батьківський Id чату.

![image](https://user-images.githubusercontent.com/62243357/117722087-51a20100-b1e9-11eb-8652-dbb63614b0cb.png)

Далі реалізуємо основний функціонал боту додавання та видалення користувачів. 

Для цього імпортуємо обидві створені вище моделі: ![image](https://user-images.githubusercontent.com/62243357/117722460-c4ab7780-b1e9-11eb-8831-167bbd6d6cba.png)

Далі свторюємо асинхронну функцію `createUser`, яка приймає параметр userData ![image](https://user-images.githubusercontent.com/62243357/117724143-03dac800-b1ec-11eb-9f38-5a06ce308507.png)

В середині створюємо дві  `let` змінні та чотири `const` змінні - данні користувача ![image](https://user-images.githubusercontent.com/62243357/117724556-98452a80-b1ec-11eb-9f9f-97d819cbdfc4.png)

Дані користувача передаються при використанні створеної функції, дві інші змінні потрібні для відслідковування можливих помилок, про які вказано вище. Ключове слово `await` змусить інтерпретатор JavaScript чекати до тих пір, поки проміс зправа від await НЕ виконається. Після чого воно поверне його результат, і виконання коду продовжиться.

Після змінної chat додамо перевірку на існування його у базі даних, якщо чату не існує створюється новий об'єкт.

![image](https://user-images.githubusercontent.com/62243357/117725492-e149ae80-b1ed-11eb-8229-1cb517d7ea14.png)

Аналогічна перевірка для користувача у даному чаті. Якщо користувача не існує - створюємо новий об'єкт, використовуючи створену раніше модель User. Додаємо до об'єкту chat індекс користувача (номер у списку) та його id (при видаленні та повторному створенні користувача індекси не видаляються) зберігаємо користувача у базу даних. Якщо користувач існує - повертається сповіщення про це. Далі зберігаємо чат у базу даних та повертаємо проміс з елементами user, chat та message. Останній відправляється користувачу у будь-якому разі при виклику даної функції. 

![image](https://user-images.githubusercontent.com/62243357/117726711-a47eb700-b1ef-11eb-806c-b3150947344f.png)

Створюємо другу асинхронну функцію `deleteUser`. При її виклику виконується пошук по данним користувача, який її викликав. Якщо користувач існує в базі даних, він видаляється інакше надсилається сповіщення про помилку сервера.

![image](https://user-images.githubusercontent.com/62243357/117727085-3ab2dd00-b1f0-11eb-8375-f66fe6c28b02.png)

На цьому проектування серверної частини (роботи з базою даних) завершені. Далі ми будемо проектувати front-end (зовнішній вигляд бота).

### 2.2 Зовнішня частина. Робота користувача з ботом
Для початку напишемо привітання бота, яке надсилається при підключенні користувача по команді `/start`.  У новий файл `App.js` імпротуємо модуль `React` та об'єкт `Text` з бібліотеки `UrbanBot`. ![image](https://user-images.githubusercontent.com/62243357/117828639-ac376d80-b27a-11eb-80d4-33117b0ea92c.png)

Створюємо функцію `App`, яка нічого не виконує, але повертає об'єкт `Text`, в якому пишемо привітання для нового користувача, в якому можна додати список команд, які виконуються ботом. 

![image](https://user-images.githubusercontent.com/62243357/117830154-071d9480-b27c-11eb-9f27-feafe4685c57.png)

В такому вигляді бот при кожному повідомлені від користувача буде надсилати привітний текст. Для того, щоб уникнути цього використаємо об'єкт `Router`. Він дозволяє роділити компоненти у середині нього на окремі, незалежні один від одного шляхи. В нашому випадку ми будемо використовувати `Route`, щоб привітнє повідомлення надсилалося тільки по команді `/start`. Таким чином код набуде такого вигляду: 

![image](https://user-images.githubusercontent.com/62243357/117831081-ec97eb00-b27c-11eb-92f9-b53fe3aef98e.png)

Для подальшого використання цієї функції додамо ключове слово `export` перед функцією. ![image](https://user-images.githubusercontent.com/62243357/117831383-2bc63c00-b27d-11eb-8345-c731d8a3678a.png)



